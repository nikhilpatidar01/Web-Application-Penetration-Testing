
#  `$_FILES` Upload in PHP

This guide explains how to upload files in PHP using the `$_FILES` superglobal. It covers the basics, PHP configuration, file upload form, and multiple PHP scripts with validation for file size and type.

---

## 1. What is `$_FILES`?
 
When a user uploads a file via an HTML form, PHP stores information about the uploaded file in the `$_FILES` array.

### Structure of `$_FILES['file']`:

| Key        | Description                                |
| ---------- | ------------------------------------------ |
| `name`     | Original name of the uploaded file         |
| `type`     | MIME type (provided by browser, untrusted) |
| `tmp_name` | Temporary filename of the uploaded file    |
| `error`    | Error code (0 = success)                   |
| `size`     | Size of uploaded file in bytes             |

---

## 2. PHP Configuration (`php.ini`)

To allow file uploads and set limits, ensure the following directives are properly set in your `php.ini`:

Configuration File Location
```bash
/etc/php/8.2/apache2/php.ini
```
Configure
```ini
file_uploads = On
upload_max_filesize = 2048M
post_max_size = 2048M
memory_limit = 256M
max_execution_time = 400
max_input_vars = 4000
```

After changing the config, restart Apache:

```bash
systemctl restart apache2.service
```

---

## 3. Prepare Upload Directory

Create a directory to store uploaded files and set proper permissions:

```bash
mkdir -p /var/www/html/php/upload
chown www-data:www-data /var/www/html/php/upload
chmod 755 /var/www/html/php/upload
ls -lh /var/www/html/php/ | grep upload
```

---

## 4. Basic File Upload Form (`fileupload.php`)

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>File Upload</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
    input[type="submit"] { margin-top: 15px; }
  </style>
</head>
<body>
  <h2>Upload a File</h2>
  <form action="process-fileupload.php" method="POST" enctype="multipart/form-data">
    <label for="file-name">File Name:</label>
    <input type="text" name="file_name" id="file-name" placeholder="Enter a name for the file" required />

    <label for="file-upload">Select File to Upload:</label>
    <input type="file" name="file-upload" id="file-upload" required />

    <input type="submit" name="submit" value="Upload" />
  </form>
</body>
</html>
```

---

## 5. Process Upload Script (`process-fileupload.php`)

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Process File Upload</title>
</head>
<body>
  <h2>ðŸ“¥ File Upload Result</h2>

  <pre><?php print_r($_POST); ?></pre>
  <pre><?php print_r($_FILES); ?></pre>

<?php
if (isset($_FILES['file-upload'])) {
    $file_name      = $_FILES['file-upload']['name'];
    $file_type      = $_FILES['file-upload']['type'];
    $file_tmp_name  = $_FILES['file-upload']['tmp_name'];
    $file_error     = $_FILES['file-upload']['error'];
    $file_size      = $_FILES['file-upload']['size'];

    echo "File Name: {$file_name} <br />";
    echo "File Type: {$file_type} <br />";
    echo "Temporary Name: {$file_tmp_name} <br />";
    echo "File Error: {$file_error} <br />";
    echo "File Size: {$file_size} bytes <br />";

    $upload_dir = 'upload/';
    $destination = $upload_dir . basename($file_name);

    if ($file_error === UPLOAD_ERR_OK) {
        if (move_uploaded_file($file_tmp_name, $destination)) {
            echo "<p style='color: green;'>âœ” File uploaded successfully!</p>";
        } else {
            echo "<p style='color: red;'>âœ˜ Error: Failed to move uploaded file.</p>";
        }
    } else {
        echo "<p style='color: red;'>âœ˜ Upload error code: {$file_error}</p>";
    }
} else {
    echo "<p style='color: red;'>âœ˜ No file was uploaded.</p>";
}
?>
</body>
</html>
```

---

## 6. Improved File Upload Form With Retain Input (`fileupload-form1.php`)

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>File Upload</title>
</head>
<body>

<?php
$fileNameValue = isset($_POST['file_name']) ? htmlspecialchars($_POST['file_name']) : "";
?>

<form action="process-fileupload1.php" method="POST" enctype="multipart/form-data">
  <label>File Name:</label><br />
  <input type="text" name="file_name" value="<?php echo $fileNameValue; ?>" required placeholder="Enter file name" />
  <br /><br />

  <label>Select File to Upload:</label><br />
  <input type="file" name="file_upload" required accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx" />
  <br /><br />

  <input type="submit" name="submit" value="Upload" />
</form>

</body>
</html>
```

---

## 7. Process File Upload with File Type Validation (`process-fileupload1.php`)

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Process File Upload</title>
</head>
<body>

<?php
if (isset($_POST['submit'])) {

    if (isset($_FILES['file_upload']) && $_FILES['file_upload']['error'] === UPLOAD_ERR_OK) {

        $fileTmpPath = $_FILES['file_upload']['tmp_name'];
        $fileName = basename($_FILES['file_upload']['name']);
        $fileSize = $_FILES['file_upload']['size'];
        $fileType = $_FILES['file_upload']['type'];

        $fileNameCmps = explode(".", $fileName);
        $fileExtension = strtolower(end($fileNameCmps));

        // Sanitize file name
        $newFileName = preg_replace('/[^a-zA-Z0-9_-]/', '_', pathinfo($fileName, PATHINFO_FILENAME));
        $newFileName .= '.' . $fileExtension;

        $uploadFileDir = 'upload/';
        if (!is_dir($uploadFileDir)) {
            mkdir($uploadFileDir, 0755, true);
        }

        $destPath = $uploadFileDir . $newFileName;

        // Allowed file extensions
        $allowedFileExtensions = ['jpg', 'jpeg', 'png', 'gif', 'pdf', 'doc', 'docx'];

        if (in_array($fileExtension, $allowedFileExtensions)) {
            if (move_uploaded_file($fileTmpPath, $destPath)) {
                echo "File uploaded successfully: {$newFileName}";
            } else {
                echo "Error moving the uploaded file.";
            }
        } else {
            echo "Upload failed. Allowed file types: " . implode(', ', $allowedFileExtensions);
        }

    } else {
        echo "No file uploaded or there was an upload error.";
    }

} else {
    echo "Form was not submitted properly.";
}
?>

</body>
</html>
```

---

## 8. File Upload with File Size Filter (`fileupload2.php` & `process-fileupload2.php`)

### Form (`fileupload2.php`)

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fileupload - File Size Filter</title>
</head>
<body>
  <form action="process-fileupload2.php" method="POST" enctype="multipart/form-data">
    File Name: <input type="text" name="file_name" /> <br />
    Select File to Upload: <br />
    <input type="file" name="file-upload" /> <br />
    <input type="submit" name="submit" value="Upload" />
  </form>
</body>
</html>
```

### Processing Script (`process-fileupload2.php`)

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Process Fileupload</title>
</head>
<body>
<?php
if (isset($_POST['submit'])) {
    if (isset($_FILES['file-upload']) && $_FILES['file-upload']['error'] === UPLOAD_ERR_OK) {
        $fileName = basename($_FILES['file-upload']['name']);
        $fileTmpPath = $_FILES['file-upload']['tmp_name'];
        $fileSize = $_FILES['file-upload']['size'];
        $uploadDir = 'upload/';
        $maxFileSize = 30000; // 30 KB

        if ($fileSize <= $maxFileSize) {
            if (!is_dir($uploadDir)) {
                mkdir($uploadDir, 0755, true);
            }

            $destPath = $uploadDir . $fileName;
            if (move_uploaded_file($fileTmpPath, $destPath)) {
                echo "File uploaded successfully: {$fileName}";
            } else {
                echo "Could not move the uploaded file.";
            }
        } else {
            echo "File size exceeds limit. Maximum allowed size is " . ($maxFileSize / 1024) . " KB.";
        }
    } else {
        echo "No file uploaded or there was an upload error.";
    }
} else {
    echo "Form was not submitted.";
}
?>
</body>
</html>
```

---
