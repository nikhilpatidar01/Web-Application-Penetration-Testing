
# üõ°Ô∏è Content-Security-Policy (CSP) in PHP

The `Content-Security-Policy` (CSP) header enhances website security by **restricting the sources** from which content (scripts, styles, images, etc.) can be loaded. This helps **prevent Cross-Site Scripting (XSS)** and other code injection attacks.

---

## üìÅ File: `content-security-policy.php`

```php
<?php
// Set the Content-Security-Policy header with a basic policy
header("Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval';");
?>
```

---

## üìñ Policy Breakdown

| Directive            | Description                                                                         |
| -------------------- | ----------------------------------------------------------------------------------- |
| `default-src 'self'` | Restricts all default content (scripts, styles, images, fonts, etc.) to same origin |
| `script-src 'self'`  | Only allows JavaScript from same origin                                             |
| `'unsafe-inline'`    | Allows inline JavaScript (`<script>...</script>`). ‚ö†Ô∏è Not recommended               |
| `'unsafe-eval'`      | Allows `eval()` and similar methods. ‚ö†Ô∏è Unsafe and discouraged                      |

---

## ‚ö†Ô∏è Security Warning

Using `'unsafe-inline'` and `'unsafe-eval'` **weakens the effectiveness of CSP** and should be avoided unless absolutely necessary.

### ‚úÖ Production Recommendations:

* Use **external JavaScript** files.
* Use **nonces** or **hashes** for inline scripts.
* Avoid `eval()` or similar dynamic code features.

---

## ‚úÖ Best Practice Example

```php
<?php
header("Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self'; object-src 'none';");
?>
```

**This policy:**

* Allows scripts and styles from the **same origin**.
* **Blocks embedded objects** like Flash, Java applets, etc.

---

## üß™ Testing the CSP Header

### ‚úÖ Using cURL:

```bash
curl -I https://yourdomain.com/content-security-policy.php
```

Look for:

```
Content-Security-Policy: default-src 'self'; ...
```

### ‚úÖ Using Browser DevTools:

1. Open browser ‚Üí Press `F12`
2. Go to **Network > Headers**
3. Reload the page and check the **Response Headers** for `Content-Security-Policy`

---


### File: `local-script.js`

```js
document.addEventListener('DOMContentLoaded', function () {
  console.log('Local script loaded and executed.');
  const message = document.createElement('p');
  message.textContent = "This message was added by local-script.js";
  message.style.color = 'blue';
  document.body.appendChild(message);
});
```

---

## üß™ CSP Test Page

### File: `content-security-policy.php`

```php
<?php
// A basic CSP policy allowing content only from the same origin
header("Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self';");
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSP Test Page</title>
  
  <!-- Inline styles (allowed by default for styles) -->
  <style>
    body { font-family: sans-serif; background: #f0f0f5; padding: 2rem; }
    h1 { color: green; }
  </style>

  <!-- External script from same origin (allowed) -->
  <script src="local-script.js"></script>

  <!-- Inline script (blocked unless 'unsafe-inline' is enabled) -->
  <script>
    console.log("Inline script executed"); // Likely blocked
  </script>
</head>
<body>
  <h1>Content Security Policy Test</h1>

  <!-- Local image (allowed) -->
  <img src="logo.png" alt="Local image" width="150">

  <!-- External image (blocked) -->
  <img src="https://example.com/external-image.jpg" alt="External image" width="150">

  <p>Check the browser console for CSP violations.</p>
</body>
</html>
```

---

‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡§æ **`content-security-policy-unsafe.php`** file properly cleaned, corrected ‡§î‡§∞ formatted Markdown ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§ú‡•à‡§∏‡§æ ‡§Ü‡§™‡§®‡•á ‡§¨‡§æ‡§ï‡•Ä content ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡§æ‡§Ç‡§ó‡§æ ‡§•‡§æ:

---

### `content-security-policy-unsafe.php`

```php
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSP Test Page</title>

  <!-- Inline styles (generally allowed without 'unsafe-inline' for styles) -->
  <style>
    body { font-family: sans-serif; background: #f0f5f5; padding: 2rem; }
    h1 { color: green; }
  </style>

  <!-- Local script (should be allowed) -->
  <script src="local-script.js"></script>

  <!-- Inline script (will only work because 'unsafe-inline' is allowed) -->
  <script>
    console.log("Inline script executed"); // Should be allowed due to unsafe-inline
  </script>
</head>
<body>
  <h1>Content Security Policy Test</h1>

  <!-- Local image (should be allowed) -->
  <img src="logo.png" alt="Local image" width="150">

  <!-- External image (will be blocked due to img-src 'self') -->
  <img src="https://www.armourinfosec.com/wp-content/uploads/2015/08/web-about.png" alt="External image" width="150">

  <p>Check the browser console for CSP violations.</p>
</body>
</html>
```



----

### üñºÔ∏è Required Files

* `local-script.js` ‚Äî JavaScript that adds a message to the page.
* `logo.png` ‚Äî Local image used to test CSP image rules.
* `content-security-policy.php` ‚Äî Main test page.

Place all files in the **same directory**.

---

## ‚úÖ Expected Behavior Table

| Item            | Source             | Expected Result |
| --------------- | ------------------ | --------------- |
| Local image     | Same origin        | ‚úÖ Allowed       |
| External image  | `example.com`      | ‚ùå Blocked       |
| Inline script   | Inline inside HTML | ‚ùå Blocked       |
| External script | `local-script.js`  | ‚úÖ Allowed       |

---

## üí° Tips

* Use **DevTools > Console** to see blocked resources and CSP violations.
* Inline scripts are blocked **unless** `'unsafe-inline'` is explicitly allowed.
* To allow trusted external domains, update the policy:

```php
header("Content-Security-Policy: script-src 'self' https://trusted.cdn.com;");
```

---

