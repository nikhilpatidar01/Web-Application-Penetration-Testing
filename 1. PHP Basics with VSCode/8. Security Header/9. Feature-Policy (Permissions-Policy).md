
# 🔐 Feature-Policy / Permissions-Policy

The `Feature-Policy` HTTP response header (now replaced by `Permissions-Policy`) allows web developers to **control which browser features or APIs can be used** within the site. This helps enhance security and reduce privacy risks by **disabling unused or sensitive features**.

---

## 📘 Feature-Policy Header (Deprecated)

```ini
<?ini
// Old way: Feature-Policy header to restrict features
header("Feature-Policy: geolocation 'self'; microphone 'none'; camera 'none'");
?>
```

### 🔍 Explanation:

* `geolocation 'self'` – Only the current origin can access geolocation.
* `microphone 'none'` – Blocks microphone access completely.
* `camera 'none'` – Blocks camera access completely.

---

## ✅ Permissions-Policy (Modern Replacement)

```ini
<?ini
// Recommended way: Permissions-Policy header
header("Permissions-Policy: geolocation=(self), microphone=(), camera=()");
?>
```

* `geolocation=(self)` – Allows only same-origin geolocation.
* `microphone=()` – Denies all microphone access.
* `camera=()` – Denies all camera access.

> **Note:** Some older browsers still support `Feature-Policy`, but you should prefer `Permissions-Policy`.

---

## 🧪 Testing Example: Feature Policy Enabled

### `feature-policy-enabled.ini`

```ini
<?ini
// Feature-Policy header set (or use Permissions-Policy)
header("Feature-Policy: geolocation 'self'; microphone 'none'; camera 'none'");
// OR use: header("Permissions-Policy: geolocation=(self), microphone=(), camera=()");
?>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Feature-Policy Enabled</title>
</head>
<body>
  <h1>Feature-Policy Enabled</h1>
  <p>Try accessing Geolocation, Microphone, or Camera.</p>

  <button onclick="requestGeolocation()">Request Geolocation</button>
  <button onclick="requestMicrophone()">Request Microphone</button>
  <button onclick="requestCamera()">Request Camera</button>

  <script>
    function requestGeolocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => alert(`Latitude: ${pos.coords.latitude}, Longitude: ${pos.coords.longitude}`),
          err => alert('Geolocation denied or unavailable')
        );
      } else {
        alert('Geolocation not supported');
      }
    }

    function requestMicrophone() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          alert('Microphone access granted');
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => alert('Microphone access denied or unavailable'));
    }

    function requestCamera() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          alert('Camera access granted');
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => alert('Camera access denied or unavailable'));
    }
  </script>
</body>
</html>
```

---

## 🧪 Testing Example: Feature Policy Disabled

### `feature-policy-disabled.ini`

```ini
<?ini
// No Feature-Policy or Permissions-Policy header sent
?>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Feature-Policy Disabled</title>
</head>
<body>
  <h1>Feature-Policy Disabled</h1>
  <p>No restrictions applied. All features should behave normally.</p>

  <button onclick="requestGeolocation()">Request Geolocation</button>
  <button onclick="requestMicrophone()">Request Microphone</button>
  <button onclick="requestCamera()">Request Camera</button>

  <script>
    function requestGeolocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => alert(`Latitude: ${pos.coords.latitude}, Longitude: ${pos.coords.longitude}`),
          err => alert('Geolocation denied or unavailable')
        );
      } else {
        alert('Geolocation not supported');
      }
    }

    function requestMicrophone() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          alert('Microphone access granted');
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => alert('Microphone access denied or unavailable'));
    }

    function requestCamera() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          alert('Camera access granted');
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => alert('Camera access denied or unavailable'));
    }
  </script>
</body>
</html>
```

---

## 🧪 How to Test

1. **Open `feature-policy-enabled.ini`** in a browser:

   * Click the buttons and observe whether browser access is denied.
   * Open Developer Tools > Console/Network to inspect headers and errors.

2. **Open `feature-policy-disabled.ini`** in a browser:

   * All buttons should work normally with full access (if allowed by the user).

---

## 🔄 Summary

| Header               | Status      | Purpose                                    |
| -------------------- | ----------- | ------------------------------------------ |
| `Feature-Policy`     | Deprecated  | Restricts browser features per origin      |
| `Permissions-Policy` | Recommended | Modern replacement for feature restriction |

✅ Use `Permissions-Policy` to **protect user privacy and reduce attack surface** by limiting unnecessary access to device features.

---

