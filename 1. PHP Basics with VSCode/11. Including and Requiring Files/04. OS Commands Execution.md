
# ğŸ–¥ï¸ PHP OS Commands Execution

PHP provides built-in functions to execute **Operating System (OS) commands** directly from a script. This can be helpful for system-level tasks like checking server status, manipulating files, or fetching user information.

ğŸ”— **Official PHP Manual**: [System Program Execution](https://www.php.net/manual/en/ref.exec.php)

> âš ï¸ **Security Warning**:
> Never trust user input directly in OS command functions. Always sanitize/validate input to prevent command injection vulnerabilities.

---

## ğŸ“„ Example Script: `os-commands.php`
```
os-commands.php
```
```ini
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHP OS Command Functions</title>
</head>
<body>
<h2>OS Command Execution in PHP</h2>
<pre>

<?php
// PHP Manual: https://www.php.net/manual/en/book.exec.php

$cmd = "id"; // Example command to get user info

// 1. passthru â€” Execute an external program and display raw output
passthru($cmd);

// 2. system â€” Execute an external program and display the output
// system($cmd);

// 3. exec â€” Execute and return last line (or array)
// echo exec($cmd);

// 4. shell_exec â€” Execute command via shell and return complete output as string
// echo shell_exec($cmd);

// 5. Backticks `` â€” Similar to shell_exec()
// echo `id`;

// 6. popen â€” Open a process and read output
// $f = popen($cmd, "r");
// $r = fread($f, 2096);
// echo $r;
// pclose($f);

// 7. escapeshellarg â€” Escape a string to be used as a shell argument
// $unsafe = "my file.txt";
// $safe = escapeshellarg($unsafe);
// echo $safe;

// 8. escapeshellcmd â€” Escape shell metacharacters
// $cmd = "ls -l; rm -rf /";
// $safe = escapeshellcmd($cmd);
// echo $safe;

// 9. proc_open â€” Execute a command and open file pointers for I/O
// $spec = [
//   0 => ["pipe", "r"],
//   1 => ["pipe", "w"],
//   2 => ["pipe", "w"]
// ];
// $proc = proc_open("ls -l", $spec, $pipes);
// if (is_resource($proc)) {
//   echo stream_get_contents($pipes[1]);
//   fclose($pipes[1]);
//   proc_close($proc);
// }

// 10. proc_get_status â€” Get information about a process opened by proc_open
// $status = proc_get_status($proc);
// print_r($status);

// 11. proc_terminate â€” Kill a process opened by proc_open
// proc_terminate($proc);

// 12. proc_close â€” Close a process opened by proc_open
// $exit = proc_close($proc);
// echo $exit;

// 13. proc_nice â€” Change the priority of the current process
// proc_nice(10);
?>

</pre>
</body>
</html>

```

---

## ğŸª› Step-by-Step Explanation

### âœ… Setting Up the Command

```php
$cmd = "id";
```

* This is a common Linux command to display user ID, group ID, and privileges.

---

## ğŸ§° OS Command Functions

### 1. `passthru()`

```php
passthru($cmd);
```

* Executes the command.
* Outputs raw result directly (used for binary output like PDF/images).

### 2. `system()`

```php
system($cmd);
```

* Outputs each line as it's received.
* Returns the **last line** of output.

### 3. `exec()`

```php
echo exec($cmd); // Last line only

exec($cmd, $output);
print_r($output); // Full array of lines
```

* Returns **last line** or entire result as array.

### 4. `shell_exec()`

```php
echo shell_exec($cmd);
```

* Executes and returns **entire output** as a string.

### 5. Backticks (\`)

```php
echo `id`;
```

* Short syntax for `shell_exec()`.

### 6. `popen()` and `fread()`

```php
$file = popen("id", "r");
$read = fread($file, 2096);
echo $read;
pclose($file);
```

* Opens a command stream as a file pointer.
* Use `fread()` to read result, and close with `pclose()`.

---

## âœ… Full Example with `shell_exec()`

```php
<?php
$cmd = "id";
$output = shell_exec($cmd);
echo "<pre>$output</pre>";
?>
```

---

## âœ… Best Practices

* âœ… **Always sanitize user input**

```php
$userInput = "test.txt";
$safeInput = escapeshellarg($userInput); // Add quotes
$cmd = "ls -l $safeInput";
echo shell_exec($cmd);
```

* âŒ Never run commands as `root` unless absolutely necessary.
* ğŸ§¾ Log commands in production environments.
* ğŸ” Use `escapeshellarg()` and `escapeshellcmd()` to prevent injection.

---

## ğŸ“š Summary Table

| Function       | Outputs Directly | Returns              | Notes                                 |
| -------------- | ---------------- | -------------------- | ------------------------------------- |
| `passthru()`   | âœ…                | `void`               | Used for binary output                |
| `system()`     | âœ…                | Last line (string)   | Outputs and returns last line         |
| `exec()`       | âŒ                | Last line or array   | Use array to capture all output lines |
| `shell_exec()` | âŒ                | Full output (string) | Easiest for multi-line result         |
| Backticks (\`) | âŒ                | Full output (string) | Same as `shell_exec()`                |
| `popen()`      | âŒ (manual read)  | Uses fread()         | File-like pointer to output           |

---

