
# HTML Injection - IFrame

## What is IFrame HTML Injection?

HTML injection in an iframe context occurs when user input is directly inserted into the `src` attribute of an `<iframe>`, allowing attackers to control what content is loaded and rendered within that frame. If proper validation or sanitization is missing, it can lead to serious security threats such as:

* **Clickjacking**
* **Phishing**
* **Content Spoofing**
* **Cross-site scripting via iframe context**

---

## 1. Vulnerable Code Review : HTML Injection via IFrame `src` (GET)
```php
html-injection-iframe.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Injection IFrame</title>
</head>
<body>

<h1>HTML Injection IFrame</h1>

<?php
$url = $_GET['url'];
?>

<iframe src="<?php echo $url; ?>" width="800px" height="800px"></iframe>

</body>
</html>
```

### Exploit

```bash
?url=http://evil.com/
```

### Vulnerability Explanation

* The value of `url` is inserted directly into the `src` attribute of the `<iframe>`.
* An attacker can:

  * Load an untrusted external page (phishing or clickjacking).
  * Exploit browser or iframe vulnerabilities.
  * Break out of the `src` attribute using injected quotes or tags and inject HTML or JavaScript.

---

## 2. Vulnerable Code Review : HTML Injection via POST in IFrame
```php
html-injection-iframe2.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Injection IFrame 2</title>
</head>
<body>

<h1>HTML Injection IFrame</h1>

<form action="html-injection-iframe2.php" method="POST">
  <label for="website">Choose a Website:</label>
  <select name="website" id="website">
    <option value="http://127.0.0.1/">Localhost</option>
    <option value="https://www.armourinfosec.com/">Armour Infosec</option>
    <option value="https://www.google.com/">Google</option>
    <option value="https://www.facebook.com/">Facebook</option>
    <option value="https://www.flipkart.com/">Flipkart</option> 
  </select> 
  <br><br>
  <input type="submit" name="submit" value="Submit">
</form>

<?php
if (isset($_POST['submit'])) {
  $url = $_POST['website']; // No validation
}
?>

<iframe src="<?php echo $url; ?>" width="800px" height="800px"></iframe>

</body>
</html>
```

### Exploit

Modify the form or send a custom POST request:

```bash
https://evil.com
```
> goto - Ctrl+Shift+I - I = inspect -> Elements -> Value change in Ifram src Local host to htts://evil.com

### Vulnerability Details

* The form restricts users to predefined options, **but**:

  * A crafted POST request can bypass this by submitting arbitrary values.
  * This results in loading malicious external sites into the iframe.
* There is **no input validation or whitelisting**.

---

## 3. Vulnerable Code Review : HTML Injection with Whitelist Switch
```php
html-injection-iframe3.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Injection IFrame 3</title>
</head>
<body>

<h1>HTML Injection IFrame</h1>

<form action="html-injection-iframe3.php" method="POST">
  <label for="website">Choose a Website:</label>
  <select name="website" id="website">
    <option value="0">Localhost</option>
    <option value="1">Armour Infosec</option>
    <option value="2">Google</option>
    <option value="3">Facebook</option>
    <option value="4">Flipkart</option> 
  </select>
  <br><br>
  <input type="submit" name="submit" value="Submit">
</form>

<?php
if (isset($_POST['submit'])) {
  switch ($_POST['website']) {
    case '0':
      $url = "http://192.168.129.144/";
      break;
    case '1':
      $url = "https://www.armourinfosec.com/";
      break;
    case '2':
      $url = "https://www.google.com/";
      break;
    case '3':
      $url = "https://www.facebook.com/";
      break;
   case '4':
      $url = "http://www.flipkart.com/";
      break;
    default:
      $url = "http://192.168.129.144/";
      break;
  }
}
?>

<iframe src="<?php echo $url; ?>" width="800px" height="800px"></iframe>

</body>
</html>
```


### Exploit

Modify the form or send a custom POST request:

```bash
https://evil.com
```
> goto - Ctrl+Shift+I - I = inspect -> Elements -> Value change in Ifram src Local host to htts://evil.com

---

### Security Notes

* The user input is mapped to a **whitelisted set of URLs** via `switch`, so arbitrary injection is **not possible**.
* If someone sends an invalid option, the default safe URL is used.
* The `$url` is echoed directly, but since the values are predefined and trusted, the injection risk is **low**.
* **Still, escaping output is a good practice**, even if input is controlled.

---

## Summary Table

| File                       | User Controls `src`? | Vulnerable to Arbitrary URL? | Notes                              |
| -------------------------- | -------------------- | ---------------------------- | ---------------------------------- |
| html-injection-iframe.php  | Yes (via GET)        | Yes                          | Most dangerous                     |
| html-injection-iframe2.php | Yes (via POST)       | Yes (crafted POST)           | Hidden risk, bypass via POST       |
| html-injection-iframe3.php | Menu only            | No                           | Safer due to server-side whitelist |

---


### ‚úÖ IFrame Injection Testing ‚Äî Accurate & Clean Summary (Simplified & Verified)

1. **Check if the iframe source is dynamic (user-controlled)**
   ‚Üí If the `src` is set using user input (like GET or POST), it‚Äôs potentially vulnerable.

2. **Test if JavaScript runs on iframe errors**
   ‚Üí Broken iframe URLs sometimes trigger JS execution. Useful for XSS chaining.

3. **Self-IFrame Injection Method (local test)**
   ‚Üí Inject your own site/page inside an iframe to test clickjacking, content spoofing, or self-injection behavior.

4. **Check how user input is handled in iframe-related variables**
   ‚Üí These things matter:

   * Is Regex used to filter the input?
   * Is the Regex strong or weak (e.g., loose patterns)?
   * Are special characters like `<`, `>`, `"`, `'` filtered or escaped?
   * Are HTML entities (e.g., `&lt;`, `&gt;`) applied?

5. **Check for File Inclusion or Local File Read**
   ‚Üí Try to input paths like `/etc/passwd` or `../../config.php`.

   * If they load or show error, you may have LFI (Local File Inclusion) or file read issues.

6. **Check for use of PHP's `readfile()` function**
   ‚Üí This function directly reads and outputs files. If tied to user input without filtering, it can be exploited.
   ‚Üí Refer: [PHP readfile() - W3Schools](https://www.w3schools.com/php/func_filesystem_readfile.asp)

---

### üîê Cross-Site Scripting (XSS)

‚Üí Must be understood fully.
‚Üí IFrame-based injections often connect with XSS when quotes (`"`, `'`) or tags are injected into the iframe's `src` or surrounding HTML.

---

### üîß Tools to Use for Manual Testing

* **Browser Dev Tools** ‚Äî Inspect elements, modify values, test injections live.
* **Burp Suite** ‚Äî Craft GET/POST payloads and monitor responses.
* **Source Code Review** ‚Äî Read the PHP, HTML, and JS to understand logic and flow.

---


