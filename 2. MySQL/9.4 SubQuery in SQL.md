
## ğŸ§  **SubQuery (Nested Query) in SQL**

A **SubQuery** is a **query inside another query**. It's mainly used in:

* `SELECT`, `WHERE`, or `FROM` clauses
* When filtering data **based on results from another table**
* Often used with operators like `IN`, `=`, `NOT EXISTS`, `ANY`, etc.

---

### ğŸ”¹ **Basic Syntax:**

```sql
SELECT columns
FROM table1
WHERE column = (
  SELECT column
  FROM table2
  WHERE condition
);
```

---

### ğŸ”¸ Example Dataset

Let's say we have two tables:

**`users`**

| user\_id | name | course\_name |
| -------- | ---- | ------------ |
| 1        | Aman | 2            |
| 2        | Riya | 1            |

**`course`**

| course\_id | course\_name                |
| ---------- | --------------------------- |
| 1          | Information Security Expert |
| 2          | Website Security Expert     |

---

### ğŸ” 1. View all records in the users table:

```sql
SELECT * FROM users;
```

---

### ğŸ“Œ 2. Show users with course\_name = 1 (assuming it's an ID):

```sql
SELECT * FROM users WHERE course_name = 1;
```

---

### ğŸ“š 3. View all records in the course table:

```sql
SELECT * FROM course;
```

---

### âŒ 4. Incorrect way to search using course name (if `course_name` is a foreign key):

```sql
-- Wonâ€™t work if `course_name` in users is a numeric ID
SELECT * FROM users WHERE course_name = 'Information Security Expert';
```

---

### âœ… 5. Correct way â€” Use SubQuery

#### ğŸ”¸ Get course ID for â€˜Information Security Expertâ€™:

```sql
SELECT course_id
FROM course
WHERE course_name = 'Information Security Expert';
```

#### ğŸ”¸ Find users enrolled in â€˜Information Security Expertâ€™:

```sql
SELECT *
FROM users
WHERE course_name = (
  SELECT course_id
  FROM course
  WHERE course_name = 'Information Security Expert'
);
```

---

### ğŸ” Similar: Users in â€˜Website Security Expertâ€™

```sql
SELECT *
FROM users
WHERE course_name = (
  SELECT course_id
  FROM course
  WHERE course_name = 'Website Security Expert'
);
```

---

## ğŸš« SubQuery with `NOT EXISTS`

Use `NOT EXISTS` to exclude records where a match **does exist** in another table.

---

### ğŸ”¹ Syntax:

```sql
SELECT columns
FROM table1
WHERE NOT EXISTS (
  SELECT columns
  FROM table2
  WHERE condition
);
```

---

### ğŸ§ª Example:

#### ğŸ”¸ Select users only if â€˜Information Security Expertâ€™ **does not exist** in course table:

```sql
SELECT *
FROM users
WHERE NOT EXISTS (
  SELECT course_id
  FROM course
  WHERE course_name = 'Information Security Expert'
);
```

If the course exists â¤ returns **zero** users
If the course doesn't â¤ returns **all** users

---

### âš ï¸ Common Mistake (Typos & Syntax)

Incorrect version:

```sql
-- âŒ Incorrect alias, syntax and misquoted values
SELECT * FROM users
WHERE NOT EXISTS (
  SELECT course-id FROM course
  WHERE course_name = "Website Security"
);
```

Corrected:

```sql
SELECT *
FROM users
WHERE NOT EXISTS (
  SELECT course_id
  FROM course
  WHERE course_name = 'Website Security'
);
```

---

## âœ… Summary: When to Use SubQueries

| Use Case                               | Method                                        |
| -------------------------------------- | --------------------------------------------- |
| Lookup values from another table       | `=`, `IN`, `EXISTS` with SubQuery             |
| Check if a value does **not exist**    | `NOT EXISTS`                                  |
| Filter based on **aggregated results** | SubQuery in `HAVING` or use `JOIN + GROUP BY` |

---

