
## 🔍 HAVING Clause in SQL

The `HAVING` clause is used **to filter grouped records** after an aggregate function like `COUNT()`, `SUM()`, `AVG()`, etc., has been applied.

> ✅ Use `HAVING` **after** `GROUP BY` to filter grouped results.
> ❌ Don’t use `WHERE` with aggregate functions — that causes an error.

---

### 🧠 Syntax:

```sql
SELECT column1, AGG_FUNC(column2)
FROM table_name
GROUP BY column1
HAVING condition;
```

---

### 📘 Examples (Using `users` table)

#### 🔸 View all records:

```sql
SELECT * FROM users;
```

#### 🔸 Get all male users (using `WHERE`):

```sql
SELECT * FROM users WHERE gender = 'M';
```

#### 🔸 Get all female users:

```sql
SELECT * FROM users WHERE gender = 'F';
```

#### 🔸 List all distinct genders:

```sql
SELECT gender FROM users GROUP BY gender;
```

#### 🔸 Count users in each gender:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender;
```

#### 🔸 Show only male group after grouping:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender
HAVING gender = 'M';
```

#### 🔸 Show gender(s) with exactly 4 users:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender
HAVING COUNT(*) = 4;
```

---

### ❌ Invalid Example (Using `WHERE` with aggregate function — WRONG):

```sql
-- ❌ Will throw error
SELECT gender, COUNT(*)
FROM users
GROUP BY gender
WHERE COUNT(*) = 4;
```

Use `HAVING` instead of `WHERE` when filtering aggregate results.

---

## 🌆 City-Based Grouping (With `JOIN`)

### 🔸 List all cities:

```sql
SELECT city_name FROM users;
```

### 🔸 List distinct cities:

```sql
SELECT city_name FROM users GROUP BY city_name;
```

### 🔸 Count users per city:

```sql
SELECT city_name, COUNT(*) AS total_users
FROM users
GROUP BY city_name;
```

---

### 🧩 Count users per city (JOIN with `city` table):

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name;
```

#### 🔸 Cities with exactly 2 users:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) = 2;
```

#### 🔸 Cities with fewer than 2 users:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) < 2;
```

#### 🔸 Cities with more than 1 user:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) > 1;
```

---

## ✅ Summary

| Clause   | Works On        | When Used             |
| -------- | --------------- | --------------------- |
| `WHERE`  | Individual rows | **Before** `GROUP BY` |
| `HAVING` | Grouped results | **After** `GROUP BY`  |

---

