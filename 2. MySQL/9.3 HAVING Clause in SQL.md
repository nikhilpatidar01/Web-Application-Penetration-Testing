
## ğŸ” HAVING Clause in SQL

The `HAVING` clause is used **to filter grouped records** after an aggregate function like `COUNT()`, `SUM()`, `AVG()`, etc., has been applied.

> âœ… Use `HAVING` **after** `GROUP BY` to filter grouped results.
> âŒ Donâ€™t use `WHERE` with aggregate functions â€” that causes an error.

---

### ğŸ§  Syntax:

```sql
SELECT column1, AGG_FUNC(column2)
FROM table_name
GROUP BY column1
HAVING condition;
```

---

### ğŸ“˜ Examples (Using `users` table)

#### ğŸ”¸ View all records:

```sql
SELECT * FROM users;
```

#### ğŸ”¸ Get all male users (using `WHERE`):

```sql
SELECT * FROM users WHERE gender = 'M';
```

#### ğŸ”¸ Get all female users:

```sql
SELECT * FROM users WHERE gender = 'F';
```

#### ğŸ”¸ List all distinct genders:

```sql
SELECT gender FROM users GROUP BY gender;
```

#### ğŸ”¸ Count users in each gender:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender;
```

#### ğŸ”¸ Show only male group after grouping:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender
HAVING gender = 'M';
```

#### ğŸ”¸ Show gender(s) with exactly 4 users:

```sql
SELECT gender, COUNT(*) AS total_users
FROM users
GROUP BY gender
HAVING COUNT(*) = 4;
```

---

### âŒ Invalid Example (Using `WHERE` with aggregate function â€” WRONG):

```sql
-- âŒ Will throw error
SELECT gender, COUNT(*)
FROM users
GROUP BY gender
WHERE COUNT(*) = 4;
```

Use `HAVING` instead of `WHERE` when filtering aggregate results.

---

## ğŸŒ† City-Based Grouping (With `JOIN`)

### ğŸ”¸ List all cities:

```sql
SELECT city_name FROM users;
```

### ğŸ”¸ List distinct cities:

```sql
SELECT city_name FROM users GROUP BY city_name;
```

### ğŸ”¸ Count users per city:

```sql
SELECT city_name, COUNT(*) AS total_users
FROM users
GROUP BY city_name;
```

---

### ğŸ§© Count users per city (JOIN with `city` table):

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name;
```

#### ğŸ”¸ Cities with exactly 2 users:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) = 2;
```

#### ğŸ”¸ Cities with fewer than 2 users:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) < 2;
```

#### ğŸ”¸ Cities with more than 1 user:

```sql
SELECT city.city_name, COUNT(*) AS total_users
FROM users
INNER JOIN city ON users.city_name = city.city_id
GROUP BY city.city_name
HAVING COUNT(*) > 1;
```

---

## âœ… Summary

| Clause   | Works On        | When Used             |
| -------- | --------------- | --------------------- |
| `WHERE`  | Individual rows | **Before** `GROUP BY` |
| `HAVING` | Grouped results | **After** `GROUP BY`  |

---

