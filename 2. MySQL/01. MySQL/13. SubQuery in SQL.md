
## 🧠 **SubQuery (Nested Query) in SQL**

A **SubQuery** is a **query inside another query**. It's mainly used in:

* `SELECT`, `WHERE`, or `FROM` clauses
* When filtering data **based on results from another table**
* Often used with operators like `IN`, `=`, `NOT EXISTS`, `ANY`, etc.

---

### 🔹 **Basic Syntax:**

```sql
SELECT columns
FROM table1
WHERE column = (
  SELECT column
  FROM table2
  WHERE condition
);
```

---

### 🔸 Example Dataset

Let's say we have two tables:

**`user2`**

| user\_id | name | course\_name |
| -------- | ---- | ------------ |
| 1        | Aman | 2            |
| 2        | Riya | 1            |

**`course`**

| course\_id | course\_name                |
| ---------- | --------------------------- |
| 1          | Ethical Hacking |
| 2          | Website Security Expert     |

---

### 🔍 1. View all records in the user2 table:

```sql
SELECT * FROM user2;
```

---

### 📌 2. Show user2 with course\_name = 1 (assuming it's an ID):

```sql
SELECT * FROM course WHERE course_id = 1;
```

---

### 📚 3. View all records in the course table:

```sql
SELECT * FROM course;
```

---

### ❌ 4. Incorrect way to search using course name (if `course_name` is a foreign key):

```sql
-- Won’t work if `course_name` in user2 is a numeric ID
SELECT * FROM user2 WHERE course_name = 'IT Security';
```

---

### ✅ 5. Correct way — Use SubQuery

#### 🔸 Get course ID for ‘Ethical Hacking’:

```sql
SELECT course_id
FROM course
WHERE course_name = 'Ethical Hacking';
```

#### 🔸 Find user2 enrolled in ‘Ethical Hacking’:

```sql
SELECT *
FROM user2
WHERE course_name = (
  SELECT course_id
  FROM course
  WHERE course_name = 'Ethical Hacking'
);
```

---

### 🔁 Similar: user2 in ‘Website Security Expert’

```sql
SELECT *
FROM user2
WHERE course_name = (
  SELECT course_id
  FROM course
  WHERE course_name = 'Website Security Expert'
);
```

---

## 🚫 SubQuery with `NOT EXISTS`

Use `NOT EXISTS` to exclude records where a match **does exist** in another table.

---

### 🔹 Syntax:

```sql
SELECT columns
FROM table1
WHERE NOT EXISTS (
  SELECT columns
  FROM table2
  WHERE condition
);
```

---

### 🧪 Example:

#### 🔸 Select user2 only if ‘Ethical Hacking’ **does not exist** in course table:

```sql
SELECT *
FROM user2
WHERE NOT EXISTS (
  SELECT course_id
  FROM course
  WHERE course_name = 'Ethical Hacking'
);
```

If the course exists ➤ returns **zero** user2
If the course doesn't ➤ returns **all** user2

---

### ⚠️ Common Mistake (Typos & Syntax)

Incorrect version:

```sql
-- ❌ Incorrect alias, syntax and misquoted values
SELECT * FROM user2
WHERE NOT EXISTS (
  SELECT course-id FROM course
  WHERE course_name = "Website Security"
);
```

Corrected:

```sql
SELECT *
FROM user2
WHERE NOT EXISTS (
  SELECT course_id
  FROM course
  WHERE course_name = 'Website Security'
);
```

---

## ✅ Summary: When to Use SubQueries

| Use Case                               | Method                                        |
| -------------------------------------- | --------------------------------------------- |
| Lookup values from another table       | `=`, `IN`, `EXISTS` with SubQuery             |
| Check if a value does **not exist**    | `NOT EXISTS`                                  |
| Filter based on **aggregated results** | SubQuery in `HAVING` or use `JOIN + GROUP BY` |

---

